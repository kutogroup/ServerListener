<!doctype html>
<html class="no-js h-100" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>服务器监控页面</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="css/all.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" id="main-stylesheet" data-version="1.1.0" href="styles/shards-dashboards.1.1.0.min.css">
    <link rel="stylesheet" href="styles/extras.1.1.0.min.css">
    <script src="js/moment.min.js"></script>
    <script async defer src="js/buttons.js"></script>
</head>

<body class="h-100">
    <div class="container-fluid">
        <div class="row">
            <main class="main-content col-lg-10 col-md-9 col-sm-12 p-0 offset-lg-2 offset-md-3">
                <div class="main-content-container container-fluid px-4">
                    <!-- Page Header -->
                    <div class="page-header row no-gutters py-4">
                        <div class="col-12 col-sm-4 text-center text-sm-left mb-0">
                            <span class="text-uppercase page-subtitle">Dashboard</span>
                            <h3 class="page-title">服务器监控后台</h3>
                        </div>
                    </div>
                    <!-- End Page Header -->
                    <div class="row">
                        <!-- Speed Stats -->
                        <div class="col-lg-8 col-md-12 col-sm-12 mb-4">
                            <div class="card card-small">
                                <div class="card-header border-bottom">
                                    <h6 class="m-0">Speed</h6>
                                </div>
                                <div class="card-body pt-0">
                                    <div class="row border-bottom py-2 bg-light">
                                        <div class="col-12 col-sm-6">
                                            <div id="date-picker"
                                                class="input-daterange input-group input-group-sm my-auto ml-auto mr-auto ml-sm-auto mr-sm-0"
                                                style="max-width: 350px;">
                                                <input type="text" readonly class="input-sm form-control" name="start"
                                                    placeholder="Start Date" id="date-picker-1">
                                                <input type="text" readonly class="input-sm form-control" name="end"
                                                    placeholder="End Date" id="date-picker-2">
                                                <span class="input-group-append">
                                                    <span class="input-group-text" onclick="javascript:drawChart()">
                                                        <i class="material-icons"></i>
                                                    </span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <canvas id="canvas_speed" height="300" style="max-width: 100% !important;"
                                        class="blog-overview-users"></canvas>
                                    <canvas id="canvas_conns" height="300" style="max-width: 100% !important;"
                                        class="blog-overview-users"></canvas>
                                </div>
                            </div>
                        </div>
                        <!-- End Speed Stats -->
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script src="scripts/jquery-3.3.1.min.js"></script>
    <script src="scripts/popper.min.js"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <script src="scripts/Chart.min.js"></script>
    <script src="scripts/shards.min.js"></script>
    <script src="scripts/jquery.sharrre.min.js"></script>
    <script src="scripts/extras.1.1.0.min.js"></script>
    <script src="scripts/shards-dashboards.1.1.0.min.js"></script>
    <script>
        // Blog overview date range init.
        var servers;
        $('#date-picker').datepicker({});
        $('#date-picker-1').val('2019-07-08')
        $('#date-picker-2').val('2019-07-08')

        function newDate(days) {
            return moment().add(days, 'd').toDate();
        }

        function newDateString(days) {
            return moment().add(days, 'd').format();
        }

        var speedModel = {
            type: 'line',
            data: {
                datasets: [
                ]
            },
            options: {
                scales: {
                    xAxes: [{
                        type: 'time',
                        scaleLabel: {
                            display: true,
                            labelString: 'Date'
                        },
                        ticks: {
                            major: {
                                fontStyle: 'bold',
                                fontColor: '#FF0000'
                            }
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Value'
                        }
                    }]
                },
            }
        };

        console.log(speedModel)

        var connsModel = {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: 'us1',
                        backgroundColor: "#FF0000",
                        borderColor: "#FF0000",
                        fill: false,
                        data: [
                        ],
                    }
                ]
            },
            options: {
                scales: {
                    xAxes: [{
                        type: 'time',
                        scaleLabel: {
                            display: true,
                            labelString: 'Date'
                        },
                        ticks: {
                            major: {
                                fontStyle: 'bold',
                                fontColor: '#FF0000'
                            }
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Value'
                        }
                    }]
                },
            }
        };

        function drawChart() {
            $.get("/speed", function (data) {
                var servers = eval("(" + data + ")")

                speedModel.data.datasets = new Array()
                for (var i = 0; i < servers.length; i++) {
                    var server = servers[i]
                    var item = {
                        label: server.title,
                        backgroundColor: server.chart_color,
                        borderColor: server.chart_color,
                        fill: false,
                        data: [
                        ],
                    }

                    for (var j = 0; j < server.speeds.length; j++) {
                        var r = parseInt(parseInt(server.speeds[j].receive) / (1024 * 1024))
                        var d = {
                            x: server.speeds[j].create_at,
                            y: r
                        }

                        item.data.push(d)
                    }
                    speedModel.data.datasets.push(item)
                }

                var ctx = document.getElementById("canvas_speed").getContext('2d');
                new Chart(ctx, speedModel)
            })

            $.get("/conns", function (data) {
                var servers = eval("(" + data + ")")

                connsModel.data.datasets = new Array()
                for (var i = 0; i < servers.length; i++) {
                    var server = servers[i]
                    var item = {
                        label: server.title,
                        backgroundColor: server.chart_color,
                        borderColor: server.chart_color,
                        fill: false,
                        data: [
                        ],
                    }

                    for (var j = 0; j < server.conns.length; j++) {
                        var d = {
                            x: server.conns[j].create_at,
                            y: parseInt(server.conns[j].conns)
                        }

                        item.data.push(d)
                    }
                    connsModel.data.datasets.push(item)
                }

                var ctx = document.getElementById("canvas_conns").getContext('2d');
                new Chart(ctx, connsModel)
            })
        }

        drawChart()
    </script>
</body>

</html>